{% extends "staffs/base.html" %}
{% load django_bootstrap5 %}

{% block main %}
<h2>利用者一覧</h2>
<a href="{% url 'careusers:new' %}">{% bootstrap_button button_type="button" content="新規登録" %}</a>

{% if object_list %}
<table class="table align-middle text-center">
    <thead>
        <tr>
            <th>ID</th>
            <th>利用者名</th>
            <th colspan='7'>標準スケジュール</th>
        </tr>
    </thead>
    <tbody>
    {% for careuser in object_list %}
        <tr>
            {% if careuser.defaultschedule_set.all|length > 0 %}
            <th rowspan="{{ careuser.defaultschedule_set.all|length }}">{{careuser.id}}</th>
            <th rowspan="{{ careuser.defaultschedule_set.all|length }}"><a href="{% url 'careusers:edit' careuser.id %}">{{careuser.last_name}} {{careuser.first_name}}</a></th>
            <th rowspan="{{ careuser.defaultschedule_set.all|length }}"><a href="{% url 'careusers:def_sche_new' careuser.id %}">{% bootstrap_button button_type="button" content="追加" %}</a></th>
            {% else %}
            <th>{{careuser.id}}</th>
            <th><a href="{% url 'careusers:edit' careuser.id %}">{{careuser.last_name}} {{careuser.first_name}}</a></th>
            <th><a href="{% url 'careusers:def_sche_new' careuser.id %}">{% bootstrap_button button_type="button" content="追加" %}</a></th>
            {% endif %}
            {% if careuser.defaultschedule_set.all|length > 0 %}
                {% for sche in careuser.defaultschedule_set.all %}
                    {% if forloop.first == False %}
                    <tr>
                    {% endif %}
                        <th>{{ sche.get_schedule_name }}</th>
                        <th>{{ sche.get_schedule_time }}</th>
                        <th>{{ sche.get_schedule_staffs }}</th>
                        <th>{{ sche.biko }}</th>
                        <th><a href="{% url 'careusers:def_sche_edit' sche.pk %}">{% bootstrap_button button_type="button" content="変更" %}</a></th>
                        <th><a class="btn btn-danger" href="{% url 'careusers:def_sche_delete' sche.pk %}"> 削除</a></th>
                        {% if forloop.first == False %}
                    </tr> 
                    {% endif %}
                {% endfor %}
            {% else %}
                <th colspan="6">スケジュール未登録</th>
            {% endif %}
            </th>
        </tr>
    {% endfor %}
    </tbody>
</table>
{% else %}
<p>利用者は登録されておりません。</p>
{% endif %}
{% endblock %}